# GENERATED BY intent
# DO NOT EDIT

name: CI
on: [push, pull_request]

jobs:
  ci:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.10", "3.12"]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: pip

      - name: Install dependencies
        run: |
          python -m pip install -U pip
          python -m pip install -e .[dev]

      - name: test
        run: |
          pytest -q

      - name: eval_clean
        run: |
          python -m atlas.evaluate --dataset data/gold/v0_slice.jsonl

      - name: eval_noisy
        run: |
          python -m atlas.evaluate --dataset data/gold/v0_noisy_slice.jsonl

      - name: eval_readback
        run: |
          python -m atlas.evaluate --readback-dataset data/gold/readback_pairs.v0.jsonl

      - name: gate_noisy
        run: |
          python -c "from pathlib import Path; from atlas.evaluate import evaluate_dataset; import sys; r=evaluate_dataset(Path('data/gold/v0_noisy_slice.jsonl')); ok=(r['intent']['f1']>=0.90 and r['slot']['f1']>=0.85 and r['status_accuracy']>=0.90); print(r); sys.exit(0 if ok else 1)"
